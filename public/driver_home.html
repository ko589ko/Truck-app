<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç”»é¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background: #d9ecff; font-family: 'Noto Sans JP', sans-serif; padding: 24px; }
    .container-box {
      max-width: 720px; background: #fff; border-radius: 16px; padding: 25px; margin: auto;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1); text-align:center;
    }
    h2 { color:#1565c0; font-weight:700; margin-bottom:6px; }
    .day-btn { border:none; padding:8px 18px; border-radius:8px; background:#e3f2fd; color:#1565c0; font-weight:600; }
    .day-btn.active { background:#1565c0; color:white; }
    .menu-btn { background:#1976d2; color:white; padding:8px 18px; border-radius:8px; border:none; font-weight:600; }

    .box { 
      text-align:left; padding:18px; 
      border:1px solid #bbdefb; border-radius:12px; background:#f9fcff; 
      margin-top:18px; font-size:17px; line-height:1.8;
      min-height: 160px;
    }

    .logout-btn { width:100%; background:#e3f2fd; border:1px solid #1565c0; padding:12px; border-radius:8px; margin-top:25px; font-weight:600; }
  </style>
</head>

<body>
<div class="container-box">

  <h2>ğŸšš ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç”»é¢</h2>
  <p style="color:#1565c0; font-weight:700;">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ï¼š<span id="driverName"></span></p>
  <hr>

  <div>
    <button id="btnToday" class="day-btn active" onclick="showToday()">ä»Šæ—¥</button>
    <button id="btnTomorrow" class="day-btn" onclick="showTomorrow()">æ˜æ—¥</button>
    <button class="menu-btn" onclick="location.href='driver_history.html'">ğŸ“œ å±¥æ­´</button>
    <button class="menu-btn" onclick="location.href='driver_inquiry.html?driver=' + encodeURIComponent(driver)">
      ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ
    </button>
    
  </div>

  <div id="todayBox" class="box">èª­ã¿è¾¼ã¿ä¸­...</div>
  <div id="tomorrowBox" class="box" style="display:none;">èª­ã¿è¾¼ã¿ä¸­...</div>

  <button class="logout-btn" onclick="location.href='index.html'">â† ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

</div>

<script>
  // âœ… ã¾ãš driver ã®å€¤ã‚’1å›ã ã‘æ±ºã‚ã‚‹
  const params = new URLSearchParams(location.search);
  let driver = params.get("driver") || localStorage.getItem("driver");

  if (!driver || driver.trim() === "") {
    // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼æœªè¨­å®š â†’ é¸æŠãƒšãƒ¼ã‚¸ã¸
    location.href = "driver_select.html";
  }

  driver = driver.trim();
  localStorage.setItem("driver", driver);
  document.getElementById("driverName").textContent = driver;

  // âœ… æŒ‡ç¤ºãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  async function loadSchedule() {
    const res = await fetch(`/api/schedule?driver=${encodeURIComponent(driver)}`);
    const data = await res.json();

    const today = new Date().toISOString().split("T")[0];
    const tomorrow = new Date(Date.now()+86400000).toISOString().split("T")[0];

    const t = data.find(d => d.date && d.date.startsWith(today));
    const n = data.find(d => d.date && d.date.startsWith(tomorrow));

    document.getElementById("todayBox").innerHTML = t ? format(t) : "æŒ‡ç¤ºã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
    document.getElementById("tomorrowBox").innerHTML = n ? format(n) : "æŒ‡ç¤ºã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
  }

  // âœ… è¡¨ç¤ºæ•´å½¢
  function format(d){
    return `
      ğŸ“ <b>è¡Œãå…ˆ</b><br>${d.destination || "-"}<br><br>
      ğŸ“¦ <b>è·ç‰©</b><br>${d.cargo || "-"}<br><br>
      ğŸš› <b>ãƒˆãƒ©ãƒƒã‚¯ç•ªå·</b><br>${d.truck_number || "-"}<br><br>
      ğŸ¢ <b>ä¼šç¤¾ã‹ã‚‰ã®æŒ‡ç¤º</b><br>${d.company_message || "ãªã—"}
    `;
  }

  // âœ… ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  function showToday(){ 
    todayBox.style.display="block"; 
    tomorrowBox.style.display="none"; 
    btnToday.classList.add("active");
    btnTomorrow.classList.remove("active");
  }

  function showTomorrow(){
    todayBox.style.display="none"; 
    tomorrowBox.style.display="block"; 
    btnTomorrow.classList.add("active");
    btnToday.classList.remove("active");
  }

  loadSchedule();
</script>


</body>
</html>
